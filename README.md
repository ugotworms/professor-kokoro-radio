# Professor Kokoro's Neverending Radio Programme

![Header Image Placeholder](tDQrhJ4JgYCH2ieSa5Ml--3--vqk4f.jpg)

## Overview

This script is designed to indefinitely stream audio content, including weather updates, time announcements, and Lovecraftian stories. It uses text-to-speech synthesis to convert text into audio and plays it along with background music. This project makes use of [kokoro-onnx](https://github.com/thewh1teagle/kokoro-onnx).

## Features

- Real-time weather updates from a specified weather station.
- Time announcements based on the current system time.
- Streaming of Lovecraftian stories with phonetic corrections for specific words.
- Background music playback.
- User input handling for dynamic TTS injection between generated text.

## Requirements

To run this script, you need to have the following Python packages installed:

```bash
pip install -requirements.txt
```

## Installation

1. Clone the repository or download the script.
2. Install the required Python packages using the command above.
3. Ensure you have the necessary audio files and configuration files in place.

## Usage

To run the script, use the following command:

```bash
python radio.py --mode <mode>
```

Replace `<mode>` with either `time_weather` or `story` depending on the desired functionality.

### Example

To run the script in `time_weather` mode:

```bash
python radio.py --mode time_weather
```

To run the script in `story` mode:

```bash
python radio.py --mode story
```

## Configuration

The script uses a configuration file named `radio_config.json` to store settings such as the current story, title, and line number. Ensure this file is present and properly formatted.

## Web Stream

It is possible to expose this stream to the internet, in a format which can be played in browsers. This involves piping your system audio output through ffmpeg via a virtual audio device (V-Cable), and hosting the stream file. Below are steps for Windows (untested). These steps were generated by DeepSeek.

### **Step 1: Install Required Tools**

1.  **Install FFmpeg**:

    - Download FFmpeg from <https://ffmpeg.org/download.html>.

    - Extract the files and add the `bin` folder to your system's `PATH`.

2.  **Install VB-Cable** (Virtual Audio Device):

    - Download and install [VB-Cable](https://vb-audio.com/Cable/).

    - This will create a virtual audio input/output device.

---

### **Step 2: Route System Audio to VB-Cable**

1.  Open **Sound Settings**:

    - Right-click the speaker icon in the taskbar and select **Sounds**.

2.  Set **VB-Cable Input** as the default playback device:

    - Go to the **Playback** tab, select `CABLE Input (VB-Audio Virtual Cable)`, and click **Set Default**.

---

### **Step 3: Capture System Audio and Create HLS Stream**

1.  Open a Command Prompt (`cmd`).

2.  Run the following `ffmpeg` command to capture system audio and create an HLS stream:

    ```bash
    ffmpeg -f dshow -i audio="CABLE Output (VB-Audio Virtual Cable)" -c:a aac -f hls -hls_time 2 -hls_playlist_type event stream.m3u8
    ```

    - This command:

      - Captures audio from the virtual audio device (`CABLE Output`).

      - Encodes it to AAC format.

      - Creates HLS segments and a playlist file (`stream.m3u8`).

---

### **Step 4: Serve the HLS Files**

1.  Use Python's built-in HTTP server to serve the HLS files:

    - Open a new Command Prompt (`cmd`).

    - Navigate to the folder containing `stream.m3u8` and the `.ts` segments.

    - Run:

```bash
    python -m http.server 8000
```

---

### **Step 5: Play the HLS Stream in a Browser**

1.  Open a browser and navigate to:

    http://localhost:8000/stream.m3u8

2.  Use a JavaScript player like [Video.js](https://videojs.com/) or [hls.js](https://github.com/video-dev/hls.js) to play the stream:

    ```html
    <!DOCTYPE html>
    <html>
      <head>
        <title>HLS Audio Stream</title>
        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
      </head>
      <body>
        <audio id="audio" controls></audio>
        <script>
          const audio = document.getElementById("audio");
          if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource("http://localhost:8000/stream.m3u8");
            hls.attachMedia(audio);
            hls.on(Hls.Events.MANIFEST_PARSED, () => audio.play());
          } else if (audio.canPlayType("application/vnd.apple.mpegurl")) {
            audio.src = "http://localhost:8000/stream.m3u8";
            audio.addEventListener("loadedmetadata", () => audio.play());
          }
        </script>
      </body>
    </html>
    ```

---

### **Step 6: Access the Stream Remotely**

1.  If you want to access the stream from another device:

    - Replace `localhost` with your machine's IP address (e.g., `http://192.168.1.100:8000/stream.m3u8`).

    - Ensure port `8000` is open in your firewall.

---

## License

This project is licensed under the MIT License.

## Acknowledgements

Special thanks to the developers of the libraries and tools used in this project.

Lovecraft corpus: [https://github.com/vilmibm/lovecraftcorpus](https://github.com/vilmibm/lovecraftcorpus)
